% function CatListGen()

% clDirs = {...
%           'Z:\data for analysis\ANM261311\20150703';...
%           'Z:\data for analysis\ANM261311\20150710';...
%           'Z:\data for analysis\ANM261311\20150716';...
%           'Z:\data for analysis\ANM261311\20150720';...
%           'Z:\data for analysis\ANM261311\20150722';...
%           'Z:\data for analysis\ANM261311\20150724';...
%           'Z:\data for analysis\ANM261313\20150630';...
%           'Z:\data for analysis\ANM261313\20150701';...
%           'Z:\data for analysis\ANM261313\20150703';...
%           'Z:\data for analysis\ANM261313\20150708';...
%           'Z:\data for analysis\ANM261313\20150714';...
%           'Z:\data for analysis\ANM261313\20150720';...
%           'Z:\data for analysis\ANM261313\20150722';...
%           'Z:\data for analysis\ANM261313\20150723';...
%           'Z:\data for analysis\ANM274690\20150713';...
%           'Z:\data for analysis\ANM274690\20150714';...
%           'Z:\data for analysis\ANM274690\20150716';...
%           'Z:\data for analysis\ANM274690\20150720';...
%           'Z:\data for analysis\ANM274690\20150722';...
%           'Z:\data for analysis\ANM274690\20150723';...
%           'Z:\data for analysis\ANM274690\20150724';...
%           'Z:\data for analysis\ANM274690\20150728';...
%           };

strDir_Img_P = 'Z:\Imaging\2P345\20170830\ANM378231';
strDir_Regexp = '_000(\d{2})_S$';
vtCatTrials = 5:12;

clDirs_Img = FindSubDirs_RegExp(strDir_Regexp, strDir_Img_P, true,1)';
[clDirs_Img,vtCounter] = SortFnByCounter(clDirs_Img,strDir_Regexp);
[vtCatDirs,idxDirs] = intersect(vtCounter,vtCatTrials);

strFn_CatList = [strDir_Img_P filesep 'CatList.log'];

nDirCount = length(idxDirs);

fid = fopen(strFn_CatList,'wt');

for nSlice =1:8
    for nDir =1:nDirCount
        idx = idxDirs(nDir);
        strDir = clDirs_Img{idx};
        clFiles = FindFiles_RegExp(['_S' num2str(nSlice) '_C\d_reg.tif$'], strDir, false)';
        strFn_S = clFiles{1};
        fprintf(fid,'%s\n',  strFn_S);
    end
    [strPath,strFn]=fileparts(strFn_S);
    strDir_Sav = [fileparts(strPath) filesep 'Reg_Cat'];
    if(~exist(strDir_Sav,'dir'))
        mkdir(strDir_Sav);
    end
    C = strsplit(strFn,'_');
    strFn_Sav = [C{1} '_' num2str(vtCatTrials(1)) '-' num2str(vtCatTrials(end)) '_' C{3} '_' C{4} '.tif'];
    fprintf(fid,'#sav#:%s\n', [strDir_Sav filesep strFn_Sav]);
end

fclose(fid);